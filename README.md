# Установка и запуск тестов (Mac OS)

1. Узнайте свою версию python 3: `python3 --version`. Ответ должен быть вида `Python 3.12.0`. Если это не так, выполните шаг 2.
2. !!! Только если у вас нет Python 3 !!! Установите **python3**: [ссылка](https://kinsta.com/knowledgebase/install-python/)
3. Создайте **virtual environment** в корне этого проекта: `python3 -m venv venv`
4. Активируйте **virtual environment**: `source venv/bin/activate`
5. Установите зависимости: `pip install -r requirements.txt`
6. Запустите все тесты: `pytest -s -v --headed`.
7. Для запуска кокретного теста: `pytest -s -v -k <имя_теста_из_@pytest.mark> --headed` - например, `pytest -s -v -k happy_path --headed`"
8. В корне приложен видео-файл с прогоном всех тестов

## Тестовые сценарии

1. Успешное заполнение формы
   1. Залогиниться (сертификат Венера)
   2. Перейти в профиль организации
   3. Открыть форму редактирования
   4. Заполнить форму и сохранить
   5. Проверить, что введенные данные сохранились в профиле орагнизации
2. Проверка ошибок полей
   1. Залогиниться (сертификат Венера)
   2. Перейти в профиль организации
   3. Открыть форму редактирования
   4. Очистить все поля
   5. Верифицировать текст ошибок
   6. Нажать "Отмена" внизу формы
3. Отмена заполнения формы и проверка того, что данные остались неизменны
   1. Залогиниться (сертификат Венера)
   2. Перейти в профиль организации
   3. Сохранить текущие данные (нужно будет далее)
   4. Открыть форму редактирования
   5. Перезаполнить только поля КПП и Юр. адрес
   6. Нажать "Отмена" внизу формы
   7. Проверить, что данные на карточке не поменялись (сравнить текущие с п. 3)

## Комментарии и рекомендации

###### Проверено на браузере Chrome 123.0.6312.105, MacOS Ventura 13.5

### Баги / замечания

1. Периодически не грузится раздел формы с адресом (бесконечный loader) - проходит само через 3-6 мин
2. В наименовании отделения банка должны быть только буквы (сейчас возможны также цифры / символы) + необходимо ограничить длину ввода
3. Надо проверять формат адреса (юр. адрес + почтовый адрес), либо подключить справочник (чтобы ограничить возможности ввода).
4. Email - надо проверять формат (сейчас можно сохранить, например, `asdasd@a`, что некорректно) + сделать ограничение по кол-ву символов
5. Телефон - надо проверять формат (если разрешены только РФ-номера; если нет - надо, возможно, расширять допустимое кол-во знаков номера). Сейчас перед первой цифрой автоматически ставится плюс.
6. Также надо добавить валидацию БИК / КПП / формата расчетных и корр счетов
7. Все ошибки полей должны быть переведены на русский (сейчас некоторые на англ)!
8. Необходимо прописать удобные id для всех важных элементов на странице - это сильно повысит testability
9. Надо разобраться, почему иногда при попытке сохранения данных вылетает ошибка “не удалось сохранить метод платежа” (происходит редко, но тем не менее)
10. Рекомендуется поставить retry == 5 (5 перезапусков в случае падений тестов) при прогонах в CI/CD - чтобы исключить flaky-фактор. НО лучше починить пункт 1
11. Рекомендуется также написать тесты на проверку дропдаунов
